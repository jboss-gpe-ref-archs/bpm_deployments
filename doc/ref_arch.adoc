:data-uri:
:toc2:
:rhtlink: link:https://www.redhat.com[Red Hat]

image::images/rhheader.png[width=900]

:numbered!:
[abstract]
== BPM Suite 6 Deployment

:numbered:

== Overview
The purpose of the reference architecture is to do a deep dive into BPM Suite 6 deployment topics of interest. 
The topics addressed are based on need or partner requests. The following topics are covered or planned:

* kie-Scanner
* Continuous Integration Deployment
* Cluster Deployment
* Upcoming deployment descriptor (that allows for in-memory kiesession)

== Pre-Requisites

== Deployment Options
Deployments are KieModule JARs which can be deployed or undeployed.  The Business-Central application of BPM Suite 6 provides a User Interface (UI) for managing deployments.
For many organizations, this means of deployment is only suitable for development.  Production and test environments often require more automated deployment means.
This reference architecture describes these additional means of deploying Kie projects. 
 
=== REST Deployment
The execution server within BPM Suite 6 provides a REST API that may be used to manage deployments.

Configuration options, such as the runtime strategy, should be specified when deploying the deployment: the configuration of a deployment can not be changed after it has already been deployed.

.Deployment via REST template
----------
curl -vv -u <user-id>:<user-password> -X POST http://<host>:<port>/business-central/rest/deployment/<deployment-id>/deploy?strategy=<runtime-strategy>
----------

- *<userId>* is the application user for BPM Suite 6
- *<user-password>* is the password for the above user
- *<host>* is the hostname or IP address for BPM Suite 6
- *<port>* is the port required for BPM Suite 6 (http or https port)
- *<deployment-id>* is an expression that contains the following elements, separated by a : character:
* group id
* artifact id
* version
* (optional) kbase id
* (optional) ksession id
- *<runtime-strategy>* is one of the three available runtime strategies of BPM Suite 6
* SINGLETON
* PER_PROCESS_INSTANCE
* PER_PROCESS

The following is an example use of the REST API to deploy a Kie Module.

.Deployment via REST Example
----------
curl -vv -u myUserId:myPassword -X POST http://localhost:8080/business-central/rest/deployment/com.redhat.gpe.refarch.bpm_signalling:processTier:1.0:bpmsignalling_base:bpmsignalling_session/deploy?strategy=PER_PROCESS_INSTANCE
----------

The REST call to undeploy a Kie project follows the same pattern, but without the strategy parameter

.Un-Deployment via REST template
----------
curl -vv -u <user-id>:<user-password> -X POST http://<host>:<port>/business-central/rest/deployment/<deployment-id>/undeploy
----------

Curl was used in the above examples, but the REST API enables any application with http client libraries to manage deployments via REST,
providing many options for managing deployments.

NOTE:
**************
Both the /deploy and /undeploy operations are asynchronous REST operations.  This means that although each of these calls will typically return a status of 202 upon completion,
the requested operaiton has not been completed.  So the actual operation may actually fail.
**************

=== Kie-Scanner Deployment


== Kie-Scanner

=== Kie-Scanner Capabilities

=== Kie Scanner and ZooKeeper

=== Kie Scanner Project Introduction

=== Procedure
* For the purposes of this documentation, the name _$REF_ARCH_HOME_ refers to the root directory of this reference architecture.

==== Step A

==== Step B

==== Step C

== Continuous Integration Deployment

=== CI Deployment options

=== CI Deployment Project Introduction

=== Procedure
* For the purposes of this documentation, the name _$REF_ARCH_HOME_ refers to the root directory of this reference architecture.

==== Step A

==== Step B

==== Step C

== Cluster Deployment

=== Clustering BPM Suite 6

=== JBoss EAP Clustering Overview

=== Cluster Deployment Project Introduction

=== Procedure
* For the purposes of this documentation, the name _$REF_ARCH_HOME_ refers to the root directory of this reference architecture.

==== Step A

==== Step B

==== Step C



== Performance Testing
* JMeter is used to drive testing of the reference architecture.
* You do not need to download a separate JMeter binary nor source distribution
* Instead, JMeter will be downloaded, installed and appropriately configured as part of the configuration found in $REF_ARCH_HOME/loadtest
* jmeter maven plugin
** Notice use of the com.lazerycode.jmeter:jmeter-maven-plugin in _$REF_ARCH_HOME/loadtest/pom.xml_ 
** This maven plugin downloads, installs and appropriately configures JMeter
** This maven plugin is also used to drive test scenarios
* ref_arch.jmx
** A sample default jmeter load test definition file is included in: $REF_ARCH_HOME/loadtest/src/test/jmeter/ref_arch.jmx
** This jmeter load test definition file can be viewed and manipulated via the JMeter GUI by:
*** cd $REF_ARCH_HOME/loadtest
** Notice that the default, OOB configuration is to spawn a single client that invokes a single test case
** ./jmeter_gui.sh
* Java Sampler
** Also included is an example Java _Sampler_ at:  $REF_ARCH_HOME/loadtest/src/test/java/com/redhat/gpe/refarch/ref_arch_template/loadtest/ExampleJMeterClient.java
** The use of a JMeter _sampler_ class is optional
** cd $REF_ARCH_HOME/loadtest
** mvn clean verify

== To-Do
. resolve this problem
. resolve that problem
=======
